<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8' />
    <title>AFCON</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />

    <script src="https://www.gstatic.com/firebasejs/5.4.2/firebase.js"></script>
    <script>
        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyCeNsxZBlZm0XabOdKT_ROhIpI7xFsBy2Y",
            authDomain: "afcon-db.firebaseapp.com",
            databaseURL: "https://afcon-db.firebaseio.com",
            projectId: "afcon-db",
            storageBucket: "afcon-db.appspot.com",
            messagingSenderId: "348263747069"
        };
        firebase.initializeApp(config);
    </script>
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.46.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.46.0/mapbox-gl.css' rel='stylesheet' />
    <style>
        body {
            margin: 0;
            padding: 0;
        }
        
        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }
    </style>
</head>

<body>

    <script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v2.3.0/mapbox-gl-geocoder.min.js'></script>
    <link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v2.3.0/mapbox-gl-geocoder.css' type='text/css' />
    <div id='map'></div>
    <script src='https://unpkg.com/es6-promise@4.2.4/dist/es6-promise.auto.min.js'></script>
    <script src="https://unpkg.com/@mapbox/mapbox-sdk/umd/mapbox-sdk.min.js"></script>
    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoibXlyYXNpbmhhIiwiYSI6ImNqbTBvaXEwbzI2dGczd2xpYXI4bTh5ODgifQ.8qZPyKRB1r5ywvK1h6RHnA';
        var db = firebase.database();
        var hostName, championName;
        db.ref('/2018').once('value').then(function(snapshot) {
            hostName = snapshot.val().host;
            console.log(hostName);
            championName = snapshot.val().champion;
            console.log(championName);
            var mapboxClient = mapboxSdk({
                accessToken: mapboxgl.accessToken
            });
            mapboxClient.geocoding.forwardGeocode({
                    query: hostName,
                    autocomplete: false,
                    limit: 1
                })
                .send()
                .then(function(response) {
                    if (response && response.body && response.body.features && response.body.features.length) {
                        var feature = response.body.features[0];

                        var map = new mapboxgl.Map({
                            container: 'map',
                            style: 'mapbox://styles/myrasinha/cjm0p0hyw2aef2spn7qca0umk',
                            center: feature.center,
                            zoom: 4.0,
                            maxBounds: [
                                [-180, -90],
                                [180, 90]
                            ]
                        });
                    }

                    map.addControl(new MapboxGeocoder({
                        accessToken: mapboxgl.accessToken
                    }));

                    new mapboxgl.Marker()
                        .setLngLat(feature.center)
                        .addTo(map);

                });

            console.log(hostName + "bla");

        });
    </script>

</body>

</html>